<?xml version="1.0" encoding="utf-16"?>
<ZL_OBJECT CHECKSUM="64FC5A56F3728CC4D0109FA501AE97DB" CODE_SIGNATURE="7F6E8190352EC9DEBA8CE6062BD0F682" CONNECTOR="39AC0A4B07A5A05AE1000000AC120173" NAME="YGPL_MT_PROCESS" TYPE="CLAS" VERSION="1.01">
 <DIRECTORY DEVCLASS="YGPL-MULTITHREAD" MASTERLANG="E"/>
 <RAW>
  <A0_MAINDATA VERSION="1" LANGU="E" EXPOSURE="2" STATE="1" CLSCCINCL="X" FIXPT="X" UNICODE="X" MSG_ID="YGPL_MT">
   <TEXTS>
    <ITEM LANG="E" TEXT="MT : PRocess info"/>
   </TEXTS>
  </A0_MAINDATA>
  <ALIASES>
   <ITEM CMPNAME="ACTIONS" EXPOSURE="2" REFCLSNAME="YGPL_MT_CONSTANTS" REFCMPNAME="ACTIONS"/>
   <ITEM CMPNAME="JOB_STATUS" EXPOSURE="2" REFCLSNAME="YGPL_MT_CONSTANTS" REFCMPNAME="JOB_STATUS"/>
   <ITEM CMPNAME="LOCK_MODES" EXPOSURE="2" REFCLSNAME="YGPL_MT_CONSTANTS" REFCMPNAME="LOCK_MODES"/>
   <ITEM CMPNAME="SYSTEM_CATEGORIES" EXPOSURE="2" REFCLSNAME="YGPL_MT_CONSTANTS" REFCMPNAME="SYSTEM_CATEGORIES"/>
   <ITEM CMPNAME="SYSTEM_STATUS" EXPOSURE="2" REFCLSNAME="YGPL_MT_CONSTANTS" REFCMPNAME="SYSTEM_STATUS"/>
   <ITEM CMPNAME="TD_AS_NAME" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_AS_NAME"/>
   <ITEM CMPNAME="TD_BLOC_SIZE" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_BLOC_SIZE"/>
   <ITEM CMPNAME="TD_BOOLEAN" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_BOOLEAN"/>
   <ITEM CMPNAME="TD_CATEGORY" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_CATEGORY"/>
   <ITEM CMPNAME="TD_COUNT" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_COUNT"/>
   <ITEM CMPNAME="TD_LOCK_MODE" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_LOCK_MODE"/>
   <ITEM CMPNAME="TD_MEMORY_SIZE" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_MEMORY_SIZE"/>
   <ITEM CMPNAME="TD_PROCESS_ID" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_PROCESS_ID"/>
   <ITEM CMPNAME="TD_RAWDATA" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_RAWDATA"/>
   <ITEM CMPNAME="TD_STATUS" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_STATUS"/>
   <ITEM CMPNAME="TD_TIME" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_TIME"/>
   <ITEM CMPNAME="TD_TIMESTAMP" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_TIMESTAMP"/>
   <ITEM CMPNAME="TD_WP_INDEX" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_WP_INDEX"/>
   <ITEM CMPNAME="TD_WP_NO" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_WP_NO"/>
   <ITEM CMPNAME="TD_WP_PID" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TD_WP_PID"/>
   <ITEM CMPNAME="TS_BATCH_INFO" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TS_BATCH_INFO"/>
   <ITEM CMPNAME="TS_CHRONO" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TS_CHRONO"/>
   <ITEM CMPNAME="TS_PROCESS_DEFINITION" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TS_PROCESS_DEFINITION"/>
   <ITEM CMPNAME="TS_PROGRESSION" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TS_PROGRESSION"/>
   <ITEM CMPNAME="TS_RUN" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TS_RUN"/>
   <ITEM CMPNAME="TS_WP_INFO" EXPOSURE="2" CMPTYPE="3" REFCLSNAME="YGPL_MT_TYPESPOOL" REFCMPNAME="TS_WP_INFO"/>
  </ALIASES>
  <ATTRIBUTS>
   <ITEM CMPNAME="BATCH_INFO" EXPOSURE="2" STATE="1" ATTRDONLY="X" TYPTYPE="1" TYPE="TS_BATCH_INFO">
    <TEXTS>
     <ITEM LANG="E" TEXT="Batch informations"/>
    </TEXTS>
   </ITEM>
   <ITEM CMPNAME="F_HAS_CHANGED" STATE="1" TYPTYPE="1" TYPE="TD_BOOLEAN">
    <TEXTS>
     <ITEM LANG="E" TEXT="Object has changed"/>
    </TEXTS>
   </ITEM>
   <ITEM CMPNAME="F_IS_FINAL" STATE="1" TYPTYPE="1" TYPE="TD_BOOLEAN">
    <TEXTS>
     <ITEM LANG="E" TEXT="Object is final"/>
    </TEXTS>
   </ITEM>
   <ITEM CMPNAME="NO_MESSAGE" EXPOSURE="2" STATE="1" ATTDECLTYP="1" TYPTYPE="1" TYPE="TD_BOOLEAN">
    <TEXTS>
     <ITEM LANG="E" TEXT="No message send on creation"/>
    </TEXTS>
   </ITEM>
   <ITEM CMPNAME="PROCESS_ID" EXPOSURE="2" STATE="1" ATTRDONLY="X" TYPTYPE="1" TYPE="TD_PROCESS_ID">
    <TEXTS>
     <ITEM LANG="E" TEXT="Process ID (Either Run or Job) in raw format"/>
    </TEXTS>
   </ITEM>
   <ITEM CMPNAME="STATUS" EXPOSURE="2" STATE="1" ATTRDONLY="X" TYPTYPE="1" TYPE="TD_STATUS">
    <TEXTS>
     <ITEM LANG="E" TEXT="Processus Status"/>
    </TEXTS>
   </ITEM>
   <ITEM CMPNAME="TIMES" EXPOSURE="1" STATE="1" TYPTYPE="1" TYPE="TS_CHRONO">
    <TEXTS>
     <ITEM LANG="E" TEXT="Timestamps"/>
    </TEXTS>
   </ITEM>
   <ITEM CMPNAME="WORKPROCESS" EXPOSURE="2" STATE="1" ATTRDONLY="X" TYPTYPE="1" TYPE="TS_WP_INFO">
    <TEXTS>
     <ITEM LANG="E" TEXT="Wokr Process information"/>
    </TEXTS>
   </ITEM>
  </ATTRIBUTS>
  <INTERFACES>
   <ITEM REFCLSNAME="YGPLIMT_PROCESS" EXPOSURE="2" STATE="1" RELTYPE="1">
    <COMPONENTS>
     <ITEM MTDNAME="AUTOSAVE">
      <SOURCE>`
  CHECK NOT f_has_changed IS INITIAL.
  save( ).
  CLEAR f_has_changed.</SOURCE>
     </ITEM>
     <ITEM MTDNAME="CHECK_STATUS">
      <SOURCE>`
  DATA it_wpinfo    TYPE STANDARD TABLE OF wpinfo.
  DATA job_status   TYPE tbtcjob-status.
  FIELD-SYMBOLS &lt;wp&gt; LIKE LINE OF it_wpinfo.
* FROM TSKHINCL @ 399
*--------------------------------------------------------------------*/
* Constants for field wp_istatus in structure wpinfo
*--------------------------------------------------------------------*/
  CONSTANTS: th_wp_slot_free  TYPE x VALUE 1,               &quot;#EC *
             th_wp_wait       TYPE x VALUE 2,               &quot;#EC *
             th_wp_run        TYPE x VALUE 4,               &quot;#EC *
             th_wp_hold       TYPE x VALUE 8,               &quot;#EC *
             th_wp_killed     TYPE x VALUE 16,              &quot;#EC *
             th_wp_shutdown   TYPE x VALUE 32,              &quot;#EC *
             th_wp_restricted TYPE x VALUE 64,              &quot;#EC *
             th_wp_new        TYPE x VALUE 128.             &quot;#EC *

  CHECK status = system_status-process-in_progress.
  ASSERT workprocess-server IS NOT INITIAL.
  CALL FUNCTION &apos;TH_WPINFO&apos;       &quot; Status @ 102
    EXPORTING
      srvname          = workprocess-server
*     WITH_CPU         = 0
    TABLES
      wplist           = it_wpinfo
    EXCEPTIONS
      send_error       = 1
      OTHERS           = 2.
  ASSERT sy-subrc = 0.

  READ TABLE it_wpinfo ASSIGNING &lt;wp&gt;
       WITH KEY    wp_no = workprocess-no
                  wp_pid = workprocess-pid
                wp_index = workprocess-index.
  ASSERT sy-subrc = 0.

  IF &lt;wp&gt;-wp_istatus = th_wp_run OR &lt;wp&gt;-wp_istatus = th_wp_hold.     RETURN.     ENDIF.    &quot; process is dead

  IF batch_info IS INITIAL.
* Check user/program ?
  ELSE.
    CALL FUNCTION &apos;BP_JOB_CHECKSTATE&apos;
      EXPORTING
        dialog                             = &apos;N&apos;  &quot;#EC NOTEXT No dialog
        jobcount                           = batch_info-jobcount
        jobname                            = batch_info-jobname
*       START_ASAP                         =
*       TIME_LIMIT                         =
      IMPORTING
*       STATUS_ACCORDING_TO_DB             =
        actual_status                      = job_status
      EXCEPTIONS
        checking_of_job_has_failed         = 1
        correcting_job_status_failed       = 2
        invalid_dialog_type                = 3
        job_does_not_exist                 = 0
        no_check_privilege_given           = 0
        ready_switch_too_dangerous         = 6
        OTHERS                             = 7.
    ASSERT sy-subrc = 0.
    IF job_status = me-&gt;job_status-running.   RETURN.    ENDIF.
  ENDIF.

  f_has_changed = abap_true.
  status = system_status-process-interupted.</SOURCE>
     </ITEM>
     <ITEM MTDNAME="CONV_RAW2DATA">
      <SOURCE>`
  ygpl_mt_messaging=&gt;conv_raw2data( EXPORTING rawdata = rawdata
                                     CHANGING    data = data ).</SOURCE>
     </ITEM>
     <ITEM MTDNAME="IS_SYSTEM_MESSAGE_ALLOWED"/>
     <ITEM MTDNAME="READ">
      <SOURCE>`
  DATA _data TYPE ygplmt_process.

  lock_with_share( ).

  SELECT SINGLE * INTO _data
    FROM ygplmt_process
    WHERE process_id = me-&gt;process_id.

  ASSERT sy-subrc = 0.

  status = _data-status.
  workprocess-server = _data-wp_server.
  workprocess-index = _data-wp_index.
  workprocess-no = _data-wp_no.
  workprocess-pid = _data-wp_pid.

  IF NOT f_is_final IS INITIAL.   unlock_with_share( ).   ENDIF.</SOURCE>
     </ITEM>
     <ITEM MTDNAME="REFRESH">
      <SOURCE>`
  read( ).</SOURCE>
     </ITEM>
     <ITEM MTDNAME="SAVE">
      <SOURCE>`
  DATA _process TYPE ygplmt_process.

  lock_exclusive( ).
* Lock release at commit.
  _process-process_id = process_id.
  _process-status = status.
  _process-wp_server = workprocess-server.
  _process-wp_index = workprocess-index.
  _process-wp_no = workprocess-no.
  _process-wp_pid = workprocess-pid.
  _process-timestamp = times-start.
  MODIFY ygplmt_process FROM _process.
  ASSERT sy-subrc = 0.</SOURCE>
     </ITEM>
    </COMPONENTS>
   </ITEM>
  </INTERFACES>
  <LOCAL>
   <TYPES>`
*&quot;* use this source file for any type declarations (class
*&quot;* definitions, interfaces or data types) you need for method
*&quot;* implementation or private method&apos;s signature</TYPES>
   <IMPLEMENTATIONS>`
*&quot;* local class implementation for public class
*&quot;* use this source file for the implementation part of
*&quot;* local helper classes</IMPLEMENTATIONS>
   <MACROS>`
*&quot;* use this source file for any macro definitions you need
*&quot;* in the implementation part of the class</MACROS>
  </LOCAL>
  <METHODS>
   <ITEM CMPNAME="AUTOSAVE" EXPOSURE="2" STATE="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Save if needed"/>
    </TEXTS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  CHECK NOT f_has_changed IS INITIAL.
  save( ).
  CLEAR f_has_changed.</SOURCE>
   </ITEM>
   <ITEM CMPNAME="CHECK_STATUS" EXPOSURE="2" STATE="1">
    <TEXTS>
     <ITEM LANG="E" TEXT="Check is stauts is valid (look for interupted process)"/>
    </TEXTS>
    <SOURCE>`
  DATA it_wpinfo    TYPE STANDARD TABLE OF wpinfo.
  DATA job_status   TYPE tbtcjob-status.
  FIELD-SYMBOLS &lt;wp&gt; LIKE LINE OF it_wpinfo.
* FROM TSKHINCL @ 399
*--------------------------------------------------------------------*/
* Constants for field wp_istatus in structure wpinfo
*--------------------------------------------------------------------*/
  CONSTANTS: th_wp_slot_free  TYPE x VALUE 1,               &quot;#EC *
             th_wp_wait       TYPE x VALUE 2,               &quot;#EC *
             th_wp_run        TYPE x VALUE 4,               &quot;#EC *
             th_wp_hold       TYPE x VALUE 8,               &quot;#EC *
             th_wp_killed     TYPE x VALUE 16,              &quot;#EC *
             th_wp_shutdown   TYPE x VALUE 32,              &quot;#EC *
             th_wp_restricted TYPE x VALUE 64,              &quot;#EC *
             th_wp_new        TYPE x VALUE 128.             &quot;#EC *

  CHECK status = system_status-process-in_progress.
  ASSERT workprocess-server IS NOT INITIAL.
  CALL FUNCTION &apos;TH_WPINFO&apos;       &quot; Status @ 102
    EXPORTING
      srvname          = workprocess-server
*     WITH_CPU         = 0
    TABLES
      wplist           = it_wpinfo
    EXCEPTIONS
      send_error       = 1
      OTHERS           = 2.
  ASSERT sy-subrc = 0.

  READ TABLE it_wpinfo ASSIGNING &lt;wp&gt;
       WITH KEY    wp_no = workprocess-no
                  wp_pid = workprocess-pid
                wp_index = workprocess-index.
  ASSERT sy-subrc = 0.

  IF &lt;wp&gt;-wp_istatus = th_wp_run OR &lt;wp&gt;-wp_istatus = th_wp_hold.     RETURN.     ENDIF.    &quot; process is dead

  IF batch_info IS INITIAL.
* Check user/program ?
  ELSE.
    CALL FUNCTION &apos;BP_JOB_CHECKSTATE&apos;
      EXPORTING
        dialog                             = &apos;N&apos;  &quot;#EC NOTEXT No dialog
        jobcount                           = batch_info-jobcount
        jobname                            = batch_info-jobname
*       START_ASAP                         =
*       TIME_LIMIT                         =
      IMPORTING
*       STATUS_ACCORDING_TO_DB             =
        actual_status                      = job_status
      EXCEPTIONS
        checking_of_job_has_failed         = 1
        correcting_job_status_failed       = 2
        invalid_dialog_type                = 3
        job_does_not_exist                 = 0
        no_check_privilege_given           = 0
        ready_switch_too_dangerous         = 6
        OTHERS                             = 7.
    ASSERT sy-subrc = 0.
    IF job_status = me-&gt;job_status-running.   RETURN.    ENDIF.
  ENDIF.

  f_has_changed = abap_true.
  status = system_status-process-interupted.</SOURCE>
   </ITEM>
   <ITEM CMPNAME="CONSTRUCTOR" EXPOSURE="2" STATE="1" MTDTYPE="2" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="CONSTRUCTOR"/>
    </TEXTS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E" MTDTYPE="2">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  DATA subrc    TYPE sy-subrc.
  DATA _jobinfo TYPE tbtcm.

  f_has_changed = abap_true.
  CALL FUNCTION &apos;GENERAL_GET_APP_SERVER_NAME&apos;
    IMPORTING
      server_name        = workprocess-server
    EXCEPTIONS
      error_reading_name = 1
      OTHERS             = 2.
  ASSERT sy-subrc = 0.

  CALL FUNCTION &apos;TH_GET_OWN_WP_NO&apos;
    IMPORTING
      subrc    = subrc
      wp_no    = workprocess-no
      wp_pid   = workprocess-pid
      wp_index = workprocess-index.

  process_id = generate_new_process_id( ).
  GET TIME STAMP FIELD times-start.

  IF NOT sy-batch IS INITIAL.
* From     CALL FUNCTION &apos;GET_JOB_RUNTIME_INFO&apos;
    CALL &apos;GetRuntimeInfo&apos;
      ID &apos;JOB&apos; FIELD _jobinfo.
    ASSERT sy-subrc = 0.
    batch_info = _jobinfo.
  ENDIF.
  IF no_message IS INITIAL AND sy-batch IS NOT INITIAL.
* This processus in on server (&amp;1/&amp;2) with jobname : &amp;3(&amp;4)
    MESSAGE i000 WITH workprocess-server workprocess-no batch_info-jobname batch_info-jobcount.
  ENDIF.</SOURCE>
   </ITEM>
   <ITEM CMPNAME="CONV_RAW2DATA" EXPOSURE="2" STATE="1" MTDDECLTYP="1">
    <TEXTS>
     <ITEM LANG="E" TEXT="Converti les donnée brute en donnée typé"/>
    </TEXTS>
    <PARAMETERS>
     <ITEM SCONAME="DATA" CMPTYPE="1" PARDECLTYP="2" PARPASSTYP="1" TYPTYPE="1" TYPE="ANY">
      <TEXTS>
       <ITEM LANG="E" TEXT="Donnée typée"/>
      </TEXTS>
     </ITEM>
     <ITEM SCONAME="RAWDATA" CMPTYPE="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TD_RAWDATA">
      <TEXTS>
       <ITEM LANG="E" TEXT="Donnée brute à décoder avec CONV_RAW2DATA"/>
      </TEXTS>
     </ITEM>
    </PARAMETERS>
   </ITEM>
   <ITEM CMPNAME="GENERATE_NEW_PROCESS_ID" EXPOSURE="1" STATE="1" MTDDECLTYP="1">
    <TEXTS>
     <ITEM LANG="E" TEXT="Create a new Process ID"/>
    </TEXTS>
    <PARAMETERS>
     <ITEM SCONAME="RESULT" CMPTYPE="1" PARDECLTYP="3" TYPTYPE="1" TYPE="TD_PROCESS_ID">
      <TEXTS>
       <ITEM LANG="E" TEXT="Process ID (Either Run or Job) in raw format"/>
      </TEXTS>
     </ITEM>
    </PARAMETERS>
    <SOURCE>`
  CALL FUNCTION &apos;GUID_CREATE&apos;
    IMPORTING
      ev_guid_16 = result.
*     EV_GUID_22       =
*     EV_GUID_32       = RUN_ID</SOURCE>
   </ITEM>
   <ITEM CMPNAME="IS_SYSTEM_MESSAGE_ALLOWED" EXPOSURE="2" STATE="1">
    <PARAMETERS>
     <ITEM SCONAME="RESULT" CMPTYPE="1" PARDECLTYP="3" TYPTYPE="1" TYPE="TD_BOOLEAN"/>
    </PARAMETERS>
   </ITEM>
   <ITEM CMPNAME="LOCK_EXCLUSIVE" EXPOSURE="1" STATE="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Lock record exclusive"/>
    </TEXTS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  _lock( lock_mode = ygpl_mt_lock_managment=&gt;lock_modes-write
        process_id = me-&gt;process_id ).</SOURCE>
   </ITEM>
   <ITEM CMPNAME="LOCK_WITH_SHARE" EXPOSURE="1" STATE="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Lock record &amp; sharing"/>
    </TEXTS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  _lock( lock_mode = ygpl_mt_lock_managment=&gt;lock_modes-read
        process_id = me-&gt;process_id ).</SOURCE>
   </ITEM>
   <ITEM CMPNAME="READ" EXPOSURE="2" STATE="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Read procesus definition from DB"/>
    </TEXTS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  DATA _data TYPE ygplmt_process.

  lock_with_share( ).

  SELECT SINGLE * INTO _data
    FROM ygplmt_process
    WHERE process_id = me-&gt;process_id.

  ASSERT sy-subrc = 0.

  status = _data-status.
  workprocess-server = _data-wp_server.
  workprocess-index = _data-wp_index.
  workprocess-no = _data-wp_no.
  workprocess-pid = _data-wp_pid.

  IF NOT f_is_final IS INITIAL.   unlock_with_share( ).   ENDIF.</SOURCE>
   </ITEM>
   <ITEM CMPNAME="REFRESH" EXPOSURE="2" STATE="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Refresh run informations"/>
    </TEXTS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  read( ).</SOURCE>
   </ITEM>
   <ITEM CMPNAME="SAVE" EXPOSURE="2" STATE="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Save Processus definition"/>
    </TEXTS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  DATA _process TYPE ygplmt_process.

  lock_exclusive( ).
* Lock release at commit.
  _process-process_id = process_id.
  _process-status = status.
  _process-wp_server = workprocess-server.
  _process-wp_index = workprocess-index.
  _process-wp_no = workprocess-no.
  _process-wp_pid = workprocess-pid.
  _process-timestamp = times-start.
  MODIFY ygplmt_process FROM _process.
  ASSERT sy-subrc = 0.</SOURCE>
   </ITEM>
   <ITEM CMPNAME="UNLOCK_EXCLUSIVE" EXPOSURE="1" STATE="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Unlock record (with exclusive option)"/>
    </TEXTS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  _unlock( lock_mode = ygpl_mt_lock_managment=&gt;lock_modes-write
          process_id = me-&gt;process_id ).</SOURCE>
   </ITEM>
   <ITEM CMPNAME="UNLOCK_WITH_SHARE" EXPOSURE="1" STATE="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Unlock record (lock with sharing option)"/>
    </TEXTS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  _unlock( lock_mode = ygpl_mt_lock_managment=&gt;lock_modes-read
          process_id = me-&gt;process_id ).</SOURCE>
   </ITEM>
   <ITEM CMPNAME="_LOCK" STATE="1" MTDDECLTYP="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Locking"/>
    </TEXTS>
    <PARAMETERS>
     <ITEM SCONAME="LOCK_MODE" CMPTYPE="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TD_LOCK_MODE">
      <TEXTS>
       <ITEM LANG="E" TEXT="Lock mode (E, S, X)"/>
      </TEXTS>
     </ITEM>
     <ITEM SCONAME="PROCESS_ID" CMPTYPE="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TD_PROCESS_ID">
      <TEXTS>
       <ITEM LANG="E" TEXT="Process ID"/>
      </TEXTS>
     </ITEM>
     <ITEM SCONAME="TIMEOUT" CMPTYPE="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TD_TIME" PARVALUE="60">
      <TEXTS>
       <ITEM LANG="E" TEXT="Timeout value (second)"/>
      </TEXTS>
     </ITEM>
    </PARAMETERS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  DATA _key TYPE string.
  DATA user TYPE sy-uname.

  ygpl_mt_lock_managment=&gt;get_process_clearance( process_id ).

  ygpl_mt_lock_managment=&gt;check_lock_mode( lock_mode ).

  ygpl_mt_lock_managment=&gt;set_timeout_timestamp( timeout ).
  DO.
    CALL FUNCTION &apos;ENQUEUE_EYGPLMT_PROCESS&apos;
      EXPORTING
        mode_ygplmt_process = lock_mode
        mandt               = sy-mandt
        process_id          = process_id
        x_process_id        = abap_true
        _scope              = &apos;2&apos;
        _wait               = abap_true
        _collect            = &apos; &apos;
      EXCEPTIONS
        foreign_lock        = 1
        system_failure      = 2
        OTHERS              = 3.
    IF sy-subrc = 1.
      IF ygpl_mt_lock_managment=&gt;check_timeout( ) IS INITIAL.
        CONTINUE.
      ELSE.
        user = sy-msgv1.
        _key = process_id.
        RAISE EXCEPTION TYPE ygpl_mt_cx_locks
              EXPORTING textid = ygpl_mt_cx_locks=&gt;foreign_lock
                      object_name = &apos;MT Process Data&apos;(tds)
                       object_key = _key
                             user = user.
      ENDIF.
*  else if sy-subrc &lt;&gt; 0.
    ELSE.
      ASSERT sy-subrc = 0.
    ENDIF.
    CALL FUNCTION &apos;YGPL_RELEASE_LOCK_ON_COMMIT&apos;.
    EXIT.
  ENDDO.</SOURCE>
   </ITEM>
   <ITEM CMPNAME="_UNLOCK" STATE="1" MTDDECLTYP="1" MTDNEWEXC="X">
    <TEXTS>
     <ITEM LANG="E" TEXT="Unlocking"/>
    </TEXTS>
    <PARAMETERS>
     <ITEM SCONAME="LOCK_MODE" CMPTYPE="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TD_LOCK_MODE">
      <TEXTS>
       <ITEM LANG="E" TEXT="Lock mode (E, S, X)"/>
      </TEXTS>
     </ITEM>
     <ITEM SCONAME="PROCESS_ID" CMPTYPE="1" PARPASSTYP="1" TYPTYPE="1" TYPE="TD_PROCESS_ID">
      <TEXTS>
       <ITEM LANG="E" TEXT="Process ID"/>
      </TEXTS>
     </ITEM>
    </PARAMETERS>
    <EXCEPTIONS>
     <ITEM SCONAME="YGPL_MT_CX" LANGU="E">
      <TEXTS>
       <ITEM LANG="E" TEXT="MultyThread : Root exception class"/>
      </TEXTS>
     </ITEM>
    </EXCEPTIONS>
    <SOURCE>`
  ygpl_mt_lock_managment=&gt;check_lock_mode( lock_mode ).

  CALL FUNCTION &apos;DEQUEUE_EYGPLMT_PROCESS&apos;
    EXPORTING
      mode_ygplmt_process = lock_mode
      mandt               = sy-mandt
      process_id          = process_id
      x_process_id        = abap_true
      _scope              = &apos;2&apos;
      _synchron           = &apos; &apos;
      _collect            = &apos; &apos;.

  ygpl_mt_lock_managment=&gt;release_process_clearance( process_id ).</SOURCE>
   </ITEM>
  </METHODS>
 </RAW>
</ZL_OBJECT>
